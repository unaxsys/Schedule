# Платформа за графици с PostgreSQL бекенд

## Стартиране
1. Копирайте `.env.example` в `.env` и попълнете PostgreSQL настройките.
2. Създайте база данни и изпълнете `db.schema.sql`.
3. Инсталирайте зависимости: `npm install`.
4. Стартирайте бекенда: `npm start`.
5. Отворете приложението:
   - директно от бекенда: `http://<server>:4000` (препоръчително), или
   - от друг порт/уеб сървър и задайте `API URL` в горната част (пример: `http://<server>:4000`) и натиснете **Свържи**.

## Какво има
- Ляво меню с табове: **График**, **Служители**, **Отдели**, **Отпуски**, **Настройки**, **Регистрация**. (Супер админ е отделна страница: `super-admin.html`)
- Автоматично маркиране на официални/национални празници + уикенди в календара.
- Управление на служители и годишен отпуск.
- Въвеждане на отпуск по период за избрания месец.
- Създаване на смени с различен начален/краен час (напр. дневна, вечерна, нощна).
- Изчисляване на сумирано работно време:
  - норма по месец (работни дни × 8 ч),
  - отклонение от нормата,
  - отчетен труд в официални празници,
  - отчетен труд в почивни дни,
  - платими часове според коефициенти,
  - приравняване на нощния труд (22:00–06:00) с коефициент 1.14286,
  - СИРВ отчет за период 1–6 месеца с автоматично изчисляване на извънреден труд.
- Заключване/отключване на график по месец.
- Модул „Регистрация“:
  - създаване на регистрация на организация (owner/admin по подразбиране),
  - добавяне на потребители с роли `manager` и `user` към организация.
- Супер администраторски панел:
  - самостоятелна страница `super-admin.html` (не е таб в основното приложение),
  - преглед на всички организации (tenants),
  - одобрение/промяна на статус,
  - преглед на натоварване/използване,
  - преглед на audit логове,
  - read-only инспекция на ключови таблици.
- Експорт на готов график към Excel (`.xls`) и PDF (чрез print dialog).
- Express API:
  - `GET /api/health`
  - `GET /api/state`
  - `POST /api/employees`
  - `DELETE /api/employees/:id`
  - `POST /api/schedules`
  - `GET /api/schedules?month=YYYY-MM`
  - `GET /api/schedules/:id`
  - `POST /api/schedules/:id/entry`
  - `POST /api/shift-template`
  - `DELETE /api/shift-template/:code`
  - `POST /api/platform/register`
  - `POST /api/platform/users`
  - `GET /api/platform/super-admin/overview`
  - `PATCH /api/platform/super-admin/registrations/:id/status`
  - `GET /api/platform/super-admin/tables/:tableName`
- PostgreSQL съхранение за служители, смени и графици като документи по отдели (данните остават след рестарт/обновяване на приложението).


## SaaS модел
- Базата за платформен слой използва `tenants`, `users`, `tenant_users`, `audit_log`, `request_log`.
